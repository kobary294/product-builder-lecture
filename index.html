<!DOCTYPE html>
<html>
<head>
    <title>강아지상 고양이상 테스트 - 나의 동물상은?</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href='/style.css' rel='stylesheet'>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-4846833719090912"
     crossorigin="anonymous"></script>
    <meta name="google-adsense-account" content="ca-pub-4846833719090912">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-B88SDEH9XB"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-B88SDEH9XB');
    </script>
    <script type="text/javascript">
        (function(c,l,a,r,i,t,y){
            c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
            t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
            y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
        })(window, document, "clarity", "script", "vd5kir0svq");
    </script>
</head>
<body>
    <div class="container">
        <h1>강아지/고양이 동물상 테스트</h1>
        <!-- Google AdSense ad unit -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-4846833719090912"
             data-ad-slot="YOUR_AD_SLOT_ID"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
        
        <p>
            안녕하세요! 여러분의 얼굴에서 강아지와 고양이 중 어떤 동물상이 더 많이 보이는지 궁금하신가요? 
            저희 '강아지/고양이 동물상 테스트' 사이트에서 재미있는 인공지능 분석을 통해 여러분의 동물상 지수를 확인해 보세요!
        </p>
        <p>
            이 테스트는 구글의 Teachable Machine을 활용하여 학습된 모델을 기반으로 합니다. 
            여러분의 얼굴 사진을 업로드하면, 인공지능이 강아지상의 특징과 고양이상의 특징을 분석하여 
            각각의 확률을 퍼센트로 보여드립니다. 재미로 보는 것이니 너무 진지하게 받아들이지 마세요!
        </p>
        <p>
            <b>사용 방법:</b>
            <ol>
                <li>아래 '파일 선택' 버튼을 눌러 정면 얼굴이 잘 나온 사진 파일을 업로드합니다.</li>
                <li>사진을 업로드하면 '판별하기' 버튼이 활성화됩니다.</li>
                <li>'판별하기' 버튼을 누르면 인공지능이 여러분의 동물상을 분석하고 결과를 보여줍니다.</li>
            </ol>
            지금 바로 여러분의 동물상을 찾아보세요!
        </p>

        <input type="file" id="file-input" accept="image/*">
        <img id="uploaded-image" src="#" alt="Uploaded Image" style="display:none;">
        <button type="button" id="predict-button" disabled>판별하기</button>
        <button type="button" id="reset-button">다시하기</button>
        <div id="label-container">
            <div id="loading-spinner" class="spinner" style="display:none;"></div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@latest/dist/tf.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@teachablemachine/image@latest/dist/teachablemachine-image.min.js"></script>
    <script type="text/javascript">
        const URL = "https://teachablemachine.withgoogle.com/models/dXLKfkRfa/";
        let model, maxPredictions;

        const fileInput = document.getElementById('file-input');
        const uploadedImage = document.getElementById('uploaded-image');
        const predictButton = document.getElementById('predict-button');
        const labelContainer = document.getElementById('label-container');
        const resetButton = document.getElementById('reset-button'); // Added reset button reference
        const loadingSpinner = document.getElementById('loading-spinner'); // Added loading spinner reference

        async function init() {
            const modelURL = URL + "model.json";
            const metadataURL = URL + "metadata.json";

            model = await tmImage.load(modelURL, metadataURL);
            maxPredictions = model.getTotalClasses();

            // Append prediction result divs only, spinner div is already in HTML
            for (let i = 0; i < maxPredictions; i++) {
                const predictionDiv = document.createElement("div");
                predictionDiv.className = 'prediction-result'; // Add a class for styling
                labelContainer.appendChild(predictionDiv);
            }

            predictButton.addEventListener('click', predict);
            resetButton.addEventListener('click', reset); // Added reset button event listener
        }

        fileInput.addEventListener('change', (event) => {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    uploadedImage.src = e.target.result;
                    uploadedImage.style.display = 'block';
                    predictButton.disabled = false; // Enable predict button
                    // Clear previous predictions
                    for (let i = 0; i < maxPredictions; i++) {
                        labelContainer.childNodes[i+1].innerHTML = ''; // childNodes[0] is spinner
                    }
                };
                reader.readAsDataURL(file);
            } else {
                uploadedImage.style.display = 'none';
                uploadedImage.src = '#';
                predictButton.disabled = true; // Disable predict button
                for (let i = 0; i < maxPredictions; i++) {
                    labelContainer.childNodes[i+1].innerHTML = ''; // childNodes[0] is spinner
                }
            }
        });

        async function predict() {
            if (!uploadedImage.src || uploadedImage.style.display === 'none') {
                alert('먼저 이미지를 업로드해주세요.');
                return;
            }

            // Hide previous predictions and show spinner
            for (let i = 0; i < maxPredictions; i++) {
                if (labelContainer.childNodes[i+1]) { // childNodes[0] is the spinner
                    labelContainer.childNodes[i+1].innerHTML = '';
                }
            }
            loadingSpinner.style.display = 'block';

            const prediction = await model.predict(uploadedImage);
            loadingSpinner.style.display = 'none'; // Hide spinner after prediction

            for (let i = 0; i < maxPredictions; i++) {
                const classPrediction =
                    prediction[i].className + ": " + (prediction[i].probability * 100).toFixed(2) + "%";
                if (labelContainer.childNodes[i+1]) { // childNodes[0] is the spinner
                    labelContainer.childNodes[i+1].innerHTML = classPrediction;
                }
            }
        }

        // Added reset function
        function reset() {
            fileInput.value = ''; // Clear the file input
            uploadedImage.style.display = 'none'; // Hide the image
            uploadedImage.src = '#'; // Clear the image source
            predictButton.disabled = true; // Disable predict button
            loadingSpinner.style.display = 'none'; // Ensure spinner is hidden on reset
            for (let i = 0; i < maxPredictions; i++) {
                // Clear prediction results
                if (labelContainer.childNodes[i+1]) { // childNodes[0] is the spinner
                    labelContainer.childNodes[i+1].innerHTML = '';
                }
            }
        }

        // Initialize the model when the page loads
        init();
    </script>
</body>
</html>